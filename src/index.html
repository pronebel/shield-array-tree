<html>
    <body>
        <script>
            var tree0={
            name: 'root-1',
            children: [{
              name: 'root-1-1'
            }, {
              name: 'root-1-2',
              children:[{
                name: 'root-1-2-1'
              }]
            }]
          }
        var  tree = [{
            name: 'root-1',
            children: [{
              name: 'root-1-1'
            }, {
              name: 'root-1-2',
              children:[{
                name: 'root-1-2-1'
              }]
            }]
          },
          {
            name: 'book-1',
            children: [ {
              name: 'book-1-1',
              children:[{
                name: 'book-1-1-1'
              }]
            }]
          }]
        
        function flattenTree(root, key,index=0,parentIndexes=[],parentDeeps=[]) {
            let deep = root[key] && root[key].length > 0? root[key].length : 0
            root.indexes = parentIndexes.slice()
            root.indexes.push(index)
            root.deeps= parentDeeps.slice()
            if(deep>0){
                
                root.deeps.push(deep)
            }
          let flatten = [Object.assign({}, root)];
          delete flatten[0][key];
         
          
        
          if (root[key] && root[key].length > 0) {
             
            return flatten.concat(
                root[key]
                    .map((child)=>flattenTree(child, key,index++,root.indexes,root.deeps))
                      .reduce((a, b)=>a.concat(b), [])
            );
          }
        
          return flatten;
        };
        
        
        function flattenArray (arr){
            let retArr = []
            arr.forEach((item,index) => {
                let curF = flattenTree(item,'children')
              
                retArr.push(curF)
            });
            console.log(retArr)
        }
        let aa = flattenTree(tree0,'children')

        let bb = flattenTree({
            name: 'book-1',
            children: [ {
              name: 'book-1-1',
              children:[{
                name: 'book-1-1-1'
              }]
            }]
          },'children')

        console.log(aa,bb)
        flattenArray(tree)

    </script>
    </body>
</html>